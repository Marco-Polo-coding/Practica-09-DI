import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r}from"./index.D15Q2Owl.js";import{u as S}from"./cartStore.CSZx0lk1.js";import{r as y,d as w,g as N,s as M,u as O,o as P}from"./firebaseConfig.hnSZw18Z.js";const T=({onClose:c,onLogin:l})=>{const[n,p]=r.useState(""),[d,x]=r.useState(""),[i,t]=r.useState(""),[u,s]=r.useState(""),g=async()=>{if(!n||!d){t("Por favor, completa todos los campos.");return}try{const a=y(w,"users"),m=await N(a),h=m.exists()?m.val():{},f=Object.values(h).find(b=>b.email===n&&b.password===d);if(!f){t("Correo o contraseña incorrectos.");return}localStorage.setItem("loggedInUser",JSON.stringify(f)),l(f.email),s("Inicio de sesión exitoso. ¡Bienvenido!"),setTimeout(()=>{s(""),c(),setTimeout(()=>{window.location.reload()},100)},1e3)}catch(a){console.error("Error al iniciar sesión:",a),t("Hubo un problema al iniciar sesión. Inténtalo más tarde.")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Iniciar Sesión"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"email",placeholder:"Correo electrónico",value:n,onChange:a=>p(a.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"}),e.jsx("input",{type:"password",placeholder:"Contraseña",value:d,onChange:a=>x(a.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),i&&e.jsx("div",{className:"mt-4 p-3 bg-red-100 text-red-600 rounded-lg text-sm",children:i}),u&&e.jsx("div",{className:"mt-4 p-3 bg-green-100 text-green-600 rounded-lg text-sm",children:u}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Iniciar Sesión"})]})]})})},$=({onClose:c,onRegister:l})=>{const[n,p]=r.useState(""),[d,x]=r.useState(""),[i,t]=r.useState(""),[u,s]=r.useState(""),g=async()=>{if(!n||!d){t("Por favor, completa todos los campos.");return}try{const a=n.replace(/\./g,","),m=y(w,`users/${a}`),h={email:n,password:d,purchasedCourses:[]};await M(m,h),localStorage.setItem("loggedInUser",JSON.stringify(h)),l(n),s("Registro exitoso. ¡Bienvenido!"),setTimeout(()=>{s(""),c(),setTimeout(()=>{window.location.reload()},500)},2e3)}catch(a){console.error("Error al registrar usuario:",a),t("Hubo un problema al registrar el usuario.")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Registrarse"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"email",placeholder:"Correo electrónico",value:n,onChange:a=>p(a.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"}),e.jsx("input",{type:"password",placeholder:"Contraseña",value:d,onChange:a=>x(a.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),i&&e.jsx("div",{className:"mt-4 p-3 bg-red-100 text-red-600 rounded-lg text-sm",children:i}),u&&e.jsx("div",{className:"mt-4 p-3 bg-green-100 text-green-600 rounded-lg text-sm",children:u}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrarse"})]})]})})},J=c=>c.replace(/\./g,","),A=({onClose:c,userEmail:l})=>{const[n,p]=r.useState([]),[d,x]=r.useState([]);return r.useEffect(()=>{if(!l)return;(async()=>{try{const t=J(l),u=y(w,`users/${t}`),s=y(w),g=await N(u);if(g.exists()){const m=g.val();p(m.purchasedCourses||[])}const a=await N(s);if(a.exists()){const m=a.val();x(Object.values(m).filter(h=>h.id))}}catch(t){console.error("Error al obtener los datos del usuario:",t)}})()},[l]),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full p-6 relative",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Perfil del Usuario"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Correo Electrónico:"})," ",l]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Tus Cursos Comprados"}),n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(i=>{const t=d.find(u=>u.id===i);return t?e.jsxs("div",{className:"p-4 border rounded-lg flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("a",{href:`/posts/${t.id}`,className:"font-medium text-blue-600 hover:underline",children:t.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:t.description}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["Instructor: ",t.instructor]})]}),e.jsx("img",{src:t.image,alt:t.title,className:"w-16 h-16 object-cover rounded-lg"})]},i):null})}):e.jsx("p",{className:"text-gray-700",children:"No has comprado cursos todavía."})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Cerrar"})})]})})},H=({onConfirm:c,onCancel:l})=>{const n=()=>{localStorage.removeItem("loggedInUser"),c(),setTimeout(()=>{window.location.reload()},100)};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Confirmar Cierre de Sesión"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"¿Estás seguro de que deseas cerrar sesión?"}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:l,className:"py-2 px-4 bg-gray-300 rounded-lg hover:bg-gray-400",children:"Cancelar"}),e.jsx("button",{onClick:n,className:"py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Confirmar"})]})]})})},B=({onClose:c})=>{const l=S(s=>s.cartItems),n=S(s=>s.removeFromCart),p=S(s=>s.clearCart),[d,x]=r.useState(!1),[i,t]=r.useState(!1),u=async()=>{if(l.length===0){t(!0);return}const s=JSON.parse(localStorage.getItem("loggedInUser"));if(!s||!s.email){t(!0);return}try{const g=y(w,`users/${s.email.replace(/\./g,",")}`),a=await N(g);if(!a.exists()){console.error("El usuario no existe en Firebase."),t(!0);return}const h=a.val().purchasedCourses||[],f=[...new Set([...h,...l.map(k=>k.id)])];await O(g,{purchasedCourses:f});const b={...s,purchasedCourses:f};localStorage.setItem("loggedInUser",JSON.stringify(b)),x(!0),p()}catch(g){console.error("Error al procesar la compra:",g)}};return e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-lg w-full p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Tu Carrito"}),l.length===0?e.jsx("p",{className:"text-gray-700 mb-6",children:"No tienes productos en tu carrito."}):e.jsx("div",{className:"mb-6 space-y-4",children:l.map(s=>e.jsxs("div",{className:"flex items-center p-4 border rounded-lg space-x-4",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.description}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["💵 ",s.price.toFixed(2),"€"]})]}),e.jsx("button",{onClick:()=>n(s.id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Eliminar del carrito",children:"🗑️"})]},s.id))}),e.jsxs("div",{className:"flex justify-between items-center space-x-4",children:[e.jsx("button",{onClick:c,className:"py-2 px-4 bg-gray-300 rounded-lg hover:bg-gray-400",children:"Cerrar"}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Limpiar Carrito"}),e.jsx("button",{onClick:u,className:"py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Comprar"})]})]})]}),d&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full p-6 text-center",children:[e.jsx("p",{className:"text-lg font-medium text-gray-800 mb-4",children:"¡Compra realizada con éxito!"}),e.jsx("button",{onClick:()=>{x(!1),c()},className:"py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Cerrar"})]})}),i&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full p-6 text-center",children:[e.jsx("p",{className:"text-lg font-medium text-red-600 mb-4",children:"No hay cursos en el carrito o no has iniciado sesión."}),e.jsx("button",{onClick:()=>t(!1),className:"py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400",children:"Cerrar"})]})})]})},G=()=>{const[c,l]=r.useState(""),[n,p]=r.useState([]),[d,x]=r.useState([]),[i,t]=r.useState(null),[u,s]=r.useState(null),[g,a]=r.useState(!1),[m,h]=r.useState(!1),[f,b]=r.useState(!1),[k,D]=r.useState(!1),[R,U]=r.useState(!1),E=S(o=>o.cartItems);r.useEffect(()=>{const o=JSON.parse(localStorage.getItem("loggedInUser"));o&&(t(o.email),I(o.email))},[]),r.useEffect(()=>{const o=y(w,"/"),j=P(o,v=>{const C=v.val();C&&p(Object.values(C).filter(F=>F?.title))});return()=>j()},[]);const L=o=>{const j=o.target.value;if(l(j),j.length>0){const v=n.filter(C=>C?.title?.toLowerCase().includes(j.toLowerCase()));x(v)}else x([])},I=async o=>{const j=y(w,`users/${o.replace(/\./g,",")}`),v=await N(j);v.exists()?s(v.val()):console.warn("Usuario no encontrado en Firebase")},z=()=>{localStorage.removeItem("loggedInUser"),t(null),s(null),b(!1),D(!1)};return e.jsxs("header",{className:"bg-white shadow-md sticky top-0 w-full z-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between",children:[e.jsx("a",{href:"/",className:"text-2xl font-bold text-blue-600 hover:text-blue-700 transition-colors cursor-pointer",children:"Art Academy"}),e.jsxs("div",{className:"flex-grow mx-8 relative flex items-center",children:[e.jsx("input",{type:"text",placeholder:"Buscar cursos por título...",className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600",value:c,onChange:L}),e.jsx("span",{className:"absolute right-3 top-2.5 text-gray-400",children:"🔍"}),d.length>0&&e.jsx("div",{className:"absolute top-12 left-0 w-full bg-white shadow-lg rounded-lg p-4 max-h-64 overflow-y-auto z-10",children:d.map(o=>e.jsxs("a",{href:`/posts/${o.id}`,className:"flex items-center gap-4 p-2 hover:bg-gray-100 rounded-md transition",children:[e.jsx("img",{src:o.image,alt:o.title,className:"w-12 h-12 object-cover rounded-md"}),e.jsx("span",{className:"text-gray-800 font-medium",children:o.title})]},o.id))})]}),e.jsxs("div",{className:"mr-4 cursor-pointer relative text-2xl",onClick:()=>U(!0),title:"Carrito de compras",children:["🛒",E.length>0&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-red-600 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full",children:E.length})]}),e.jsx("div",{className:"flex items-center space-x-4",children:i?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>b(!0),children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:i.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-gray-800",children:i})]}),e.jsx("button",{onClick:()=>D(!0),className:"py-2 px-4 text-red-600 border border-red-600 rounded-lg hover:bg-red-50",children:"Cerrar Sesión"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"py-2 px-4 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50",children:"Iniciar Sesión"}),e.jsx("button",{onClick:()=>h(!0),className:"py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrarse"})]})})]}),g&&e.jsx(T,{onClose:()=>a(!1),onLogin:o=>{t(o),I(o)}}),m&&e.jsx($,{onClose:()=>h(!1),onRegister:o=>{t(o),I(o)}}),f&&e.jsx(A,{onClose:()=>b(!1),userEmail:i,userData:u}),k&&e.jsx(H,{onConfirm:z,onCancel:()=>D(!1)}),R&&e.jsx(B,{onClose:()=>U(!1)})]})};export{B as C,G as H};
