import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as t}from"./index.D15Q2Owl.js";import{u as U}from"./cartStore.4-LV2-Da.js";import{r as v,d as w,g as S,s as $,u as L,o as T}from"./firebaseConfig.hnSZw18Z.js";import{u as I,C as J}from"./CoursePrice.BibBpTx-.js";const A=({onClose:i,onLogin:o})=>{const[n,p]=t.useState(""),[g,b]=t.useState(""),[x,l]=t.useState(""),[m,r]=t.useState(""),{setCurrency:d}=I(),s=async()=>{if(!n||!g){l("Por favor, completa todos los campos.");return}try{const c=v(w,"users"),u=await S(c),j=u.exists()?u.val():{},h=Object.values(j).find(y=>y.email===n&&y.password===g);if(!h){l("Correo o contraseña incorrectos.");return}localStorage.setItem("loggedInUser",JSON.stringify(h));const f=h.currency||"EUR";d(f),localStorage.setItem("currency",f),o(h.email),r("Inicio de sesión exitoso. ¡Bienvenido!"),setTimeout(()=>{r(""),i(),setTimeout(()=>{window.location.reload()},100)},1e3)}catch(c){console.error("Error al iniciar sesión:",c),l("Hubo un problema al iniciar sesión. Inténtalo más tarde.")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Iniciar Sesión"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"email",placeholder:"Correo electrónico",value:n,onChange:c=>p(c.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"}),e.jsx("input",{type:"password",placeholder:"Contraseña",value:g,onChange:c=>b(c.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),x&&e.jsx("div",{className:"mt-4 p-3 bg-red-100 text-red-600 rounded-lg text-sm",children:x}),m&&e.jsx("div",{className:"mt-4 p-3 bg-green-100 text-green-600 rounded-lg text-sm",children:m}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition",children:"Cancelar"}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Iniciar Sesión"})]})]})})},B=({onClose:i,onRegister:o})=>{const[n,p]=t.useState(""),[g,b]=t.useState(""),[x,l]=t.useState(""),[m,r]=t.useState(""),d=async()=>{if(!n||!g){l("Por favor, completa todos los campos.");return}try{const s=n.replace(/\./g,","),c=v(w,`users/${s}`),u={email:n,password:g,purchasedCourses:[]};await $(c,u),localStorage.setItem("loggedInUser",JSON.stringify(u)),o(n),r("Registro exitoso. ¡Bienvenido!"),setTimeout(()=>{r(""),i(),setTimeout(()=>{window.location.reload()},500)},2e3)}catch(s){console.error("Error al registrar usuario:",s),l("Hubo un problema al registrar el usuario.")}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Registrarse"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"email",placeholder:"Correo electrónico",value:n,onChange:s=>p(s.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"}),e.jsx("input",{type:"password",placeholder:"Contraseña",value:g,onChange:s=>b(s.target.value),className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),x&&e.jsx("div",{className:"mt-4 p-3 bg-red-100 text-red-600 rounded-lg text-sm",children:x}),m&&e.jsx("div",{className:"mt-4 p-3 bg-green-100 text-green-600 rounded-lg text-sm",children:m}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrarse"})]})]})})},z=i=>i.replace(/\./g,","),H=({onClose:i,userEmail:o})=>{const[n,p]=t.useState([]),[g,b]=t.useState([]),[x,l]=t.useState("EUR"),{setCurrency:m}=I();t.useEffect(()=>{if(!o)return;(async()=>{try{const s=z(o),c=v(w,`users/${s}`),u=await S(c);if(u.exists()){const f=u.val();p(f.purchasedCourses||[]),l(f.currency||"EUR"),m(f.currency||"EUR")}const j=v(w),h=await S(j);if(h.exists()){const f=h.val();b(Object.values(f).filter(y=>y.id))}}catch(s){console.error("Error al obtener los datos del usuario:",s)}})()},[o,m]);const r=async d=>{const s=d.target.value;if(l(s),m(s),o){const c=z(o),u=v(w,`users/${c}`);try{await L(u,{currency:s}),console.log("Preferencia de moneda actualizada en Firebase:",s)}catch(j){console.error("Error al actualizar la moneda en Firebase:",j)}}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full p-6 relative max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"overflow-y-auto max-h-[75vh] pr-2",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Perfil del Usuario"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Correo Electrónico:"})," ",o]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Preferencia de Moneda:"}),e.jsxs("select",{value:x,onChange:r,className:"w-full p-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"EUR",children:"€ Euro"}),e.jsx("option",{value:"USD",children:"$ Dólar"}),e.jsx("option",{value:"GBP",children:"£ Libra"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Tus Cursos Comprados"}),n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(d=>{const s=g.find(c=>c.id===d);return s?e.jsxs("div",{className:"p-4 border rounded-lg flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("a",{href:`/posts/${s.id}`,className:"font-medium text-blue-600 hover:underline",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.description}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["Instructor: ",s.instructor]}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["Precio: ",e.jsx(J,{price:s.price})]})]}),e.jsx("img",{src:s.image,alt:s.title,className:"w-16 h-16 object-cover rounded-lg"})]},d):null})}):e.jsx("p",{className:"text-gray-700",children:"No has comprado cursos todavía."})]})]}),e.jsx("div",{className:"mt-4 flex justify-end border-t pt-4",children:e.jsx("button",{onClick:i,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Cerrar"})})]})})},q=({onConfirm:i,onCancel:o})=>{const{setCurrency:n}=I(),p=()=>{localStorage.removeItem("loggedInUser"),n("EUR"),localStorage.removeItem("currency"),i(),setTimeout(()=>{window.location.reload()},100)};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Confirmar Cierre de Sesión"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"¿Estás seguro de que deseas cerrar sesión?"}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:o,className:"py-2 px-4 bg-gray-300 rounded-lg hover:bg-gray-400 transition",children:"Cancelar"}),e.jsx("button",{onClick:p,className:"py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Confirmar"})]})]})})},Q=({onClose:i})=>{const o=U(r=>r.cartItems),n=U(r=>r.removeFromCart),p=U(r=>r.clearCart),[g,b]=t.useState(!1),[x,l]=t.useState(!1),m=async()=>{if(o.length===0){l(!0);return}const r=JSON.parse(localStorage.getItem("loggedInUser"));if(!r||!r.email){l(!0);return}try{const d=v(w,`users/${r.email.replace(/\./g,",")}`),s=await S(d);if(!s.exists()){console.error("El usuario no existe en Firebase."),l(!0);return}const u=s.val().purchasedCourses||[],j=[...new Set([...u,...o.map(f=>f.id)])];await L(d,{purchasedCourses:j});const h={...r,purchasedCourses:j};localStorage.setItem("loggedInUser",JSON.stringify(h)),b(!0),p()}catch(d){console.error("Error al procesar la compra:",d)}};return e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Tu Carrito"}),e.jsx("div",{className:"mb-6 space-y-4 overflow-y-auto max-h-[60vh]",children:o.length===0?e.jsx("p",{className:"text-gray-700 text-center",children:"No tienes productos en tu carrito."}):o.map(r=>e.jsxs("div",{className:"flex items-center p-4 border rounded-lg space-x-4",children:[e.jsx("img",{src:r.image,alt:r.title,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:r.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:r.description}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["💵 ",r.price.toFixed(2),"€"]})]}),e.jsx("button",{onClick:()=>n(r.id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Eliminar del carrito",children:"🗑️"})]},r.id))}),e.jsxs("div",{className:"flex justify-between items-center space-x-4",children:[e.jsx("button",{onClick:i,className:"py-2 px-4 bg-gray-300 rounded-lg hover:bg-gray-400 transition",children:"Cerrar"}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Limpiar Carrito"}),e.jsx("button",{onClick:m,className:"py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Comprar"})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full p-6 text-center",children:[e.jsx("p",{className:"text-lg font-medium text-gray-800 mb-4",children:"¡Compra realizada con éxito!"}),e.jsx("button",{onClick:()=>{b(!1),i()},className:"py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Cerrar"})]})}),x&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full p-6 text-center",children:[e.jsx("p",{className:"text-lg font-medium text-red-600 mb-4",children:"No hay cursos en el carrito o no has iniciado sesión."}),e.jsx("button",{onClick:()=>l(!1),className:"py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition",children:"Cerrar"})]})})]})},Y=()=>{const[i,o]=t.useState(""),[n,p]=t.useState([]),[g,b]=t.useState([]),[x,l]=t.useState(null),[m,r]=t.useState(null),[d,s]=t.useState(!1),[c,u]=t.useState(!1),[j,h]=t.useState(!1),[f,y]=t.useState(!1),[P,E]=t.useState(!1),R=U(a=>a.cartItems);t.useEffect(()=>{const a=JSON.parse(localStorage.getItem("loggedInUser"));a&&(l(a.email),k(a.email))},[]),t.useEffect(()=>{const a=v(w,"/"),N=T(a,C=>{const D=C.val();D&&p(Object.values(D).filter(O=>O?.title))});return()=>N()},[]);const F=a=>{const N=a.target.value;if(o(N),N.length>0){const C=n.filter(D=>D?.title?.toLowerCase().includes(N.toLowerCase()));b(C)}else b([])},k=async a=>{const N=v(w,`users/${a.replace(/\./g,",")}`),C=await S(N);C.exists()?r(C.val()):console.warn("Usuario no encontrado en Firebase")},M=()=>{localStorage.removeItem("loggedInUser"),l(null),r(null),h(!1),y(!1)};return e.jsxs("header",{className:"bg-white shadow-md sticky top-0 w-full z-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between",children:[e.jsx("a",{href:"/",className:"text-2xl font-bold text-blue-600 hover:text-blue-700 transition-colors cursor-pointer",children:"Art Academy"}),e.jsxs("div",{className:"flex-grow mx-8 relative flex items-center",children:[e.jsx("input",{type:"text",placeholder:"Buscar cursos por título...",className:"w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600",value:i,onChange:F}),e.jsx("span",{className:"absolute right-3 top-2.5 text-gray-400",children:"🔍"}),g.length>0&&e.jsx("div",{className:"absolute top-12 left-0 w-full bg-white shadow-lg rounded-lg p-4 max-h-64 overflow-y-auto z-10",children:g.map(a=>e.jsxs("a",{href:`/posts/${a.id}`,className:"flex items-center gap-4 p-2 hover:bg-gray-100 rounded-md transition",children:[e.jsx("img",{src:a.image,alt:a.title,className:"w-12 h-12 object-cover rounded-md"}),e.jsx("span",{className:"text-gray-800 font-medium",children:a.title})]},a.id))})]}),e.jsxs("div",{className:"mr-4 cursor-pointer relative text-2xl",onClick:()=>E(!0),title:"Carrito de compras",children:["🛒",R.length>0&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-red-600 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full",children:R.length})]}),e.jsx("div",{className:"flex items-center space-x-4",children:x?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>h(!0),children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:x.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-gray-800",children:x})]}),e.jsx("button",{onClick:()=>y(!0),className:"py-2 px-4 text-red-600 border border-red-600 rounded-lg hover:bg-red-50",children:"Cerrar Sesión"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(!0),className:"py-2 px-4 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50",children:"Iniciar Sesión"}),e.jsx("button",{onClick:()=>u(!0),className:"py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrarse"})]})})]}),d&&e.jsx(A,{onClose:()=>s(!1),onLogin:a=>{l(a),k(a)}}),c&&e.jsx(B,{onClose:()=>u(!1),onRegister:a=>{l(a),k(a)}}),j&&e.jsx(H,{onClose:()=>h(!1),userEmail:x,userData:m}),f&&e.jsx(q,{onConfirm:M,onCancel:()=>y(!1)}),P&&e.jsx(Q,{onClose:()=>E(!1)})]})};export{Q as C,Y as H};
