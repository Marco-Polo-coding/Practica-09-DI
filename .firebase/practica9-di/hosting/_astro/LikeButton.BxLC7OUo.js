import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as t}from"./index.D15Q2Owl.js";import{r as n,d,g as b,u as E}from"./firebaseConfig.hnSZw18Z.js";const S=a=>a.replace(/\./g,","),$=({courseId:a})=>{const[g,f]=t.useState(0),[o,u]=t.useState(!1),[y,j]=t.useState(!1),[k,l]=t.useState(!1),[N,x]=t.useState(!1),[w,h]=t.useState(!1);t.useEffect(()=>{const s=JSON.parse(localStorage.getItem("loggedInUser"));if(j(!!s),s){const r=S(s.email);(async()=>{try{const c=n(d,`users/${r}`),p=await b(c);p.exists()&&p.val().purchasedCourses?.includes(a)?l(!0):l(!1)}catch(c){console.error("Error al verificar el acceso al curso:",c)}})()}(async()=>{try{const r=n(d,`/${a}`),i=await b(r);if(i.exists()){const c=i.val();f(c.likes||0)}}catch(r){console.error("Error al obtener los likes:",r)}})()},[a]);const v=async()=>{if(!y){x(!0);return}if(!k){h(!0);return}if(!o){u(!0);try{const s=g+1,m=n(d,`/${a}`);await E(m,{likes:s}),f(s)}catch(s){console.error("Error al actualizar los likes:",s)}finally{u(!1)}}},D=()=>{x(!1)},L=()=>{h(!1)};return e.jsxs("div",{className:"flex items-center justify-center relative",children:[e.jsxs("button",{onClick:v,disabled:o,className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium border transition ${o?"bg-gray-300 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-red-500 font-bold text-lg",children:"❤️"}),e.jsx("span",{className:"text-gray-700 text-sm",children:g})]}),N&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg relative z-10 w-96 flex flex-col items-center text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:'Debes iniciar sesión para dar "Me gusta".'}),e.jsx("button",{onClick:D,className:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400",children:"Entendido"})]})}),w&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg relative z-10 w-96 flex flex-col items-center text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:'Debes comprar este curso para dar "Me gusta".'}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400",children:"Entendido"})]})})]})};export{$ as default};
